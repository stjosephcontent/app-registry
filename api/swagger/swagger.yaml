swagger: "2.0"
info:
  version: "0.1.0"
  title: "SJC Application Registry"
  description: "Registry as a Service providing daemon-like assistance to SJC CLI via HTTPS RESTful API."
  termsOfService: ""
  contact:
    name: "SJC"
  license:
    name: ""
host: "localhost:10010"
basePath: "/"
schemes:
- "http"
- "https"

consumes:
- "application/json"
produces:
- "application/json"
paths:
  /applications:
    x-swagger-router-controller: "AppDefsController"
    get:
      description: "Gets a list of known applications"
      operationId: "getApplications"
      responses:
        "200":
          description: "Success"
          schema:
            type: "array"
            items:
              $ref: "#/definitions/AppDefRequest"
        default:
          description: "Error"
          schema:
            $ref: "#/definitions/ErrorResponse"
  /applications/{branch-name}:
    x-swagger-router-controller: "AppDefs"
    post:
      description: "Creates a new abstract application definition in app-reg."
      operationId: "postAppDef"
      consumes:
      - "application/json"
      produces:
      - "application/json"
      parameters:
      - name: "branch-name"
        type: "string"
        description: "Name of branch to create."
        required: true
        in: "path"
      - name: "appdef"
        schema:
          $ref: "#/definitions/AppDefRequest"
        description: "An AppDefRequest object."
        required: true
        in: "body"
      responses:
        200:
          schema:
            $ref: "#/definitions/AppDefResponse"
          description: "An AppDefResponse object."
        default:
          schema:
            $ref: "#/definitions/ErrorModel"
          description: "unexpected error"
definitions:
  AppDefRequest:
    description: "An AppDef object suitable for POST and PUT."
    type: "object"
    required:
    - "name"
    - "description"
    - "version"
    properties:
      name:
        type: "string"
        description: "The lowercase and dash-separated canonical name for this application."
      description:
        type: "string"
        description: "Unambiguously describes this specific SJC application."
      docker:
        type: "string"
      healthCheck:
        type: "string"
        description: "Placeholder while we expand the idea of a heartbeat-like feature."
        format: "uri"
        default: null
      repository:
        type: "object"
        description: "Only supporting Get at this time."
        additionalProperties:
          $ref: "#/definitions/GitRemote"
      commands:
        type: "object"
        description: "Zero, one or more shell commands."
        additionalProperties:
          $ref: "#/definitions/CommandDefinition"
      services:
        type: "object"
        description: "For now, a wrapper around Docker file."
        additionalProperties:
          $ref: "#/definitions/ServiceDefinition"
      testRunners:
        type: "object"
        description: "A list of available test runners that can be invoked within a running application instance."
        additionalProperties:
          $ref: "#/definitions/TestRunnerDefinition"
      tag:
        type: "string"
      version:
        type: "string"
        description: "The SemVer version of the current instance of an SJC application. See [http://semver.org/](http://semver.org/)"
  AppDefResponse:
    description: "An AppDef object including previously system generated UUID and ephemeralPort."
    type: "object"
    required:
    - "name"
    - "version"
    - "audit"
    properties:
      name:
        type: "string"
        description: "The lowercase and dash-separated canonical name for this application."
      branch:
        type: "string"
        description: "The repository branch name for a specific instance of this application"
        default: null
      target:
        type: "string"
        description: "The deployed location of this instance."
        default: null
      audit:
        $ref: "#/definitions/AuditInfo"
        description: "A standard SJC audit object for tracking updates to each instance of an AppDef."
      description:
        type: "string"
        description: "Unambiguously describes this specific SJC application."
      docker:
        type: "string"
      ephemeralPort:
        type: "string"
        format: "int32"
        default: null
      healthCheck:
        type: "string"
        description: "Placeholder while we expand the idea of a heartbeat-like feature."
        format: "uri"
        default: null
      repository:
        type: "object"
        description: "Only supporting Get at this time."
        additionalProperties:
          $ref: "#/definitions/GitRemote"
      commands:
        type: "object"
        description: "Zero, one or more shell commands."
        additionalProperties:
          $ref: "#/definitions/CommandDefinition"
      services:
        type: "object"
        description: "For now, a wrapper around Docker file."
        additionalProperties:
          $ref: "#/definitions/ServiceDefinition"
      testRunners:
        type: "object"
        description: "A list of available test runners that can be invoked within a running application instance."
        additionalProperties:
          $ref: "#/definitions/TestRunnerDefinition"
      tag:
        type: "string"
      version:
        type: "string"
        description: "The SemVer version of the current instance of an SJC application. See [http://semver.org/](http://semver.org/)"
  ServiceDefinition:
    description: "Is this a docker file?"
    type: "object"
    properties:
      name:
        type: "string"
        description: "Arbitrary and application unique name for the service."
      data:
        type: "object"
        description: "an object."
  TestRunnerDefinition:
    description: "Meta information required to execute a test suite."
    type: "object"
    properties:
      name:
        type: "string"
        description: "Arbitrary and application unique name for the test runner."
      runner:
        type: "object"
        description: "Details, yet to be determined."
  CommandDefinition:
    description: "A (currently) OS agnostic bash shell command. Note that there is no support for token expansion in this version."
    type: "object"
    properties:
      name:
        type: "string"
        description: "A unique name or key to reference the command."
      command:
        type: "string"
        description: "The full command line to execute."
  GitRemote:
    description: "Describes a remote reference to a Git repository."
    type: "object"
    properties:
      name:
        type: string
        description: "E.g. origin, gitlab, corpus, etc."
      uri:
        type: string
  AppTarget:
    description: "Application Targets are host environments that can run SJC applications. Since SJC applications are currently web based valid targets can be local development environments as well as cloud platforms like AWS. Future consideration may be given to hosting non web applications including native executables for mobile and desktop."
    type: "object"
    required:
    - "name"
    properties:
      audit:
        $ref: "#/definitions/AuditInfo"
      description:
        type: "string"
      endPoint:
        type: "string"
      name:
        type: "string"
      provider:
        type: "string"
      tag:
        type: "string"
  AppTemplate:
    description: "An Application Template describes an SJC standard stack plus mandatory components. Such stacks will includine LAMP, Wordpress, MEAN and Python + Django + Postgress."
    type: "object"
    required:
    - "name"
    properties:
      audit:
        $ref: "#/definitions/AuditInfo"
      description:
        type: "string"
      docker:
        type: "string"
      name:
        type: "string"
      provider:
        type: "string"
      tag:
        type: "string"
  AuditInfo:
    description: "The AuditInfo is becoming an SJC standard for conveying an auditable track of who made modifications when. It does not currently support the concept of 'what' was audited."
    type: "object"
    required:
    - "created"
    - "updated"
    properties:
      created:
        type: "object"
        required:
        - "by"
        - "on"
        properties:
          by:
            type: "string"
          on:
            type: "string"
            format: "date-time"
      updated:
        type: "object"
        required:
        - "by"
        - "on"
        properties:
          by:
            type: "string"
          on:
            type: "string"
            format: "date-time"
  ErrorModel:
    type: "object"
    required:
    - "code"
    - "message"
    properties:
      code:
        type: "integer"
        format: "int32"
      message:
        type: "string"
  ErrorResponse:
    required:
    - "message"
    properties:
      message:
        type: "string"
